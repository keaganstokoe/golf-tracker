<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚õ≥ Golf Tracker</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0f1a0f;--card:#1a2e1a;--card2:#223322;--accent:#4caf50;--accent2:#81c784;--text:#e8f5e9;--text2:#a5d6a7;--dim:#5a7a5a;--danger:#ef5350;--gold:#ffd700;--silver:#c0c0c0;--bronze:#cd7f32;--border:#2e4a2e}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding-bottom:80px}
.header{background:linear-gradient(135deg,#1b3a1b,#2d5a2d);padding:16px 20px;text-align:center;border-bottom:2px solid var(--accent);position:sticky;top:0;z-index:100}
.header h1{font-size:1.4rem;letter-spacing:1px}
.header h1 span{color:var(--accent2)}
.tabs{display:flex;position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:2px solid var(--border);z-index:100}
.tab{flex:1;padding:12px 4px;text-align:center;font-size:.75rem;color:var(--dim);cursor:pointer;transition:.2s;border:none;background:none}
.tab.active{color:var(--accent2);background:var(--card2)}
.tab-icon{font-size:1.3rem;display:block;margin-bottom:2px}
.page{display:none;padding:16px;max-width:600px;margin:0 auto}
.page.active{display:block}
.card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:12px;border:1px solid var(--border)}
.card h3{color:var(--accent2);margin-bottom:10px;font-size:1rem}
h2{color:var(--accent2);margin-bottom:16px;font-size:1.2rem;text-align:center}
.lb-row{display:flex;align-items:center;padding:10px 8px;border-radius:8px;margin-bottom:4px;transition:.2s}
.lb-row:nth-child(odd){background:rgba(76,175,80,.05)}
.lb-rank{width:32px;font-weight:700;font-size:1.1rem;text-align:center;flex-shrink:0}
.lb-name{flex:1;font-weight:500}
.lb-stats{text-align:right;font-size:.85rem;color:var(--text2)}
.lb-stats span{display:block}
.lb-stats .wins{color:var(--gold);font-weight:700}
.medal-1{color:var(--gold)}
.medal-2{color:var(--silver)}
.medal-3{color:var(--bronze)}
label{display:block;color:var(--text2);font-size:.85rem;margin-bottom:4px;margin-top:12px}
label:first-child{margin-top:0}
input,select{width:100%;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:1rem}
input:focus,select:focus{outline:none;border-color:var(--accent)}
.btn{display:block;width:100%;padding:14px;border:none;border-radius:10px;font-size:1rem;font-weight:600;cursor:pointer;margin-top:16px;transition:.2s}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{background:#43a047}
.btn-danger{background:var(--danger);color:#fff;font-size:.85rem;padding:8px}
.btn-secondary{background:var(--card2);color:var(--text2);border:1px solid var(--border);font-size:.85rem;padding:10px}
.score-input{display:flex;gap:8px;align-items:center;padding:6px 0}
.score-input label{margin:0;flex:1;font-size:.95rem;color:var(--text)}
.score-input input{width:70px;flex:none;text-align:center}
.score-input select{width:80px;flex:none}
.toggle-row{display:flex;gap:8px;margin-bottom:12px}
.toggle-btn{flex:1;padding:10px;border:1px solid var(--border);background:var(--card2);color:var(--dim);border-radius:8px;cursor:pointer;text-align:center;font-size:.85rem;transition:.2s}
.toggle-btn.active{border-color:var(--accent);color:var(--accent2);background:rgba(76,175,80,.15)}
.history-round{border-left:3px solid var(--accent);padding-left:12px;margin-bottom:16px}
.history-round .date{color:var(--accent2);font-weight:600;font-size:.9rem}
.history-round .course{color:var(--dim);font-size:.8rem}
.history-round .scores{margin-top:6px;font-size:.85rem;color:var(--text2)}
.history-round .scores div{padding:2px 0}
.history-round .winner{color:var(--gold);font-weight:600}
.streak{font-size:.75rem;color:var(--gold)}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.stat-box{background:var(--card2);border-radius:8px;padding:12px;text-align:center}
.stat-box .val{font-size:1.4rem;font-weight:700;color:var(--accent2)}
.stat-box .lbl{font-size:.7rem;color:var(--dim);margin-top:2px}
.month-filter{display:flex;align-items:center;justify-content:center;gap:12px;margin-bottom:16px}
.month-filter button{background:var(--card2);border:1px solid var(--border);color:var(--text2);padding:6px 12px;border-radius:6px;cursor:pointer;font-size:.9rem}
.setup-player{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.setup-player span{width:24px;text-align:center;font-weight:700;color:var(--accent)}
.setup-player input{flex:1}
.empty{text-align:center;color:var(--dim);padding:40px 20px;font-size:.9rem}
.team-label{font-size:.7rem;padding:2px 8px;border-radius:10px;font-weight:600}
.team-a{background:rgba(76,175,80,.2);color:var(--accent2)}
.team-b{background:rgba(33,150,243,.2);color:#64b5f6}
.cb{display:flex;align-items:center;gap:6px;padding:4px 0}
.cb input[type=checkbox]{width:18px;height:18px;accent-color:var(--accent)}
.player-check-row{display:flex;align-items:center;gap:8px;padding:6px 0}
.player-check-row label{margin:0;flex:1}
.hidden{display:none}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--accent);color:#fff;padding:12px 24px;border-radius:10px;font-weight:600;z-index:999;animation:fadeInOut 2s ease}
@keyframes fadeInOut{0%{opacity:0;transform:translateX(-50%) translateY(-10px)}15%{opacity:1;transform:translateX(-50%) translateY(0)}85%{opacity:1}100%{opacity:0}}
.team-wins-row{display:flex;justify-content:space-between;padding:8px;border-radius:8px;margin-bottom:4px;font-size:.9rem}
.team-wins-row:nth-child(odd){background:rgba(76,175,80,.05)}
</style>
</head>
<body>

<div class="header"><h1>‚õ≥ <span>Golf Tracker</span></h1></div>

<!-- Setup Screen -->
<div class="page" id="setupPage">
  <div class="card">
    <h3>üëã Welcome! Set up your group</h3>
    <p style="color:var(--dim);font-size:.85rem;margin-bottom:12px">Enter the names of your 8 players:</p>
    <div id="setupNames"></div>
    <button class="btn btn-primary" onclick="saveSetup()">Start Tracking ‚õ≥</button>
  </div>
</div>

<!-- Leaderboard -->
<div class="page" id="leaderboardPage">
  <h2>üèÜ Leaderboard</h2>
  <div class="toggle-row">
    <div class="toggle-btn active" onclick="showLB('individual')">Individual</div>
    <div class="toggle-btn" onclick="showLB('team')">Teams</div>
  </div>
  <div id="lbStats" class="stat-grid" style="margin-bottom:16px"></div>
  <div id="lbContent"></div>
</div>

<!-- Add Round -->
<div class="page" id="addRoundPage">
  <h2>üèåÔ∏è Add Round</h2>
  <div class="card">
    <label>Date</label>
    <input type="date" id="roundDate">
    <label>Course Name</label>
    <input type="text" id="roundCourse" placeholder="e.g. Randpark Golf Club">
    
    <label style="margin-top:16px">Round Type</label>
    <div class="toggle-row">
      <div class="toggle-btn active" id="typeIndividual" onclick="setRoundType('individual')">Individual</div>
      <div class="toggle-btn" id="typeTeam" onclick="setRoundType('team')">Team</div>
    </div>

    <div id="teamFormatRow" class="hidden">
      <label>Team Format</label>
      <div class="toggle-row">
        <div class="toggle-btn active" id="fmt2v2" onclick="setTeamFormat('2v2')">2v2</div>
        <div class="toggle-btn" id="fmt4v4" onclick="setTeamFormat('4v4')">4v4</div>
      </div>
    </div>

    <label>Players &amp; Scores</label>
    <div id="playerScores"></div>
    <button class="btn btn-primary" onclick="saveRound()">Save Round üíæ</button>
  </div>
</div>

<!-- History -->
<div class="page" id="historyPage">
  <h2>üìã History</h2>
  <div class="month-filter">
    <button onclick="changeMonth(-1)">‚óÄ</button>
    <span id="monthLabel"></span>
    <button onclick="changeMonth(1)">‚ñ∂</button>
  </div>
  <div id="historyContent"></div>
</div>

<!-- Settings -->
<div class="page" id="settingsPage">
  <h2>‚öôÔ∏è Settings</h2>
  <div class="card">
    <h3>Player Names</h3>
    <div id="settingsNames"></div>
    <button class="btn btn-primary" onclick="updateNames()">Update Names</button>
  </div>
  <div class="card">
    <h3>Data Management</h3>
    <button class="btn btn-secondary" onclick="exportData()" style="margin-top:8px">Export Data (JSON)</button>
    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()" style="margin-top:8px">Import Data</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
    <button class="btn btn-danger" onclick="clearData()" style="margin-top:12px">‚ö†Ô∏è Clear All Data</button>
  </div>
</div>

<!-- Bottom Tabs -->
<nav class="tabs">
  <div class="tab active" onclick="showPage('leaderboard')"><span class="tab-icon">üèÜ</span>Board</div>
  <div class="tab" onclick="showPage('addRound')"><span class="tab-icon">‚ûï</span>Add</div>
  <div class="tab" onclick="showPage('history')"><span class="tab-icon">üìã</span>History</div>
  <div class="tab" onclick="showPage('settings')"><span class="tab-icon">‚öôÔ∏è</span>Settings</div>
</nav>

<script>
// State
let state = JSON.parse(localStorage.getItem('golfTracker') || 'null') || {players:[], rounds:[]};
let currentLB = 'individual';
let roundType = 'individual';
let teamFormat = '2v2';
let historyMonth = new Date().toISOString().slice(0,7);

function save(){localStorage.setItem('golfTracker', JSON.stringify(state))}
function toast(msg){const d=document.createElement('div');d.className='toast';d.textContent=msg;document.body.appendChild(d);setTimeout(()=>d.remove(),2100)}

// Pages
function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(name+'Page').classList.add('active');
  document.querySelectorAll('.tab')[['leaderboard','addRound','history','settings'].indexOf(name)].classList.add('active');
  if(name==='leaderboard')renderLB();
  if(name==='addRound')renderAddRound();
  if(name==='history')renderHistory();
  if(name==='settings')renderSettings();
}

// Setup
function initSetup(){
  const c=document.getElementById('setupNames');
  c.innerHTML='';
  for(let i=0;i<8;i++){
    c.innerHTML+=`<div class="setup-player"><span>${i+1}</span><input type="text" id="sp${i}" placeholder="Player ${i+1}"></div>`;
  }
}

function saveSetup(){
  const names=[];
  for(let i=0;i<8;i++){const v=document.getElementById('sp'+i).value.trim();if(v)names.push(v);}
  if(names.length<2){toast('Need at least 2 players!');return}
  state.players=names;save();
  document.getElementById('setupPage').classList.remove('active');
  showPage('leaderboard');
}

// Leaderboard
function showLB(type){
  currentLB=type;
  document.querySelectorAll('#leaderboardPage .toggle-btn').forEach((b,i)=>{b.classList.toggle('active',i===(type==='individual'?0:1))});
  renderLB();
}

function getPlayerStats(){
  const stats={};
  state.players.forEach(p=>stats[p]={wins:0,rounds:0,totalScore:0,best:Infinity,worst:0,scores:[],streak:0,lastResults:[]});
  const sorted=[...state.rounds].sort((a,b)=>a.date.localeCompare(b.date));
  sorted.forEach(r=>{
    if(r.type==='team')return;
    let best=Infinity, winners=[];
    Object.entries(r.scores).forEach(([p,s])=>{
      if(!stats[p])stats[p]={wins:0,rounds:0,totalScore:0,best:Infinity,worst:0,scores:[],streak:0,lastResults:[]};
      const sc=Number(s);
      stats[p].rounds++;stats[p].totalScore+=sc;stats[p].scores.push(sc);
      if(sc<stats[p].best)stats[p].best=sc;
      if(sc>stats[p].worst)stats[p].worst=sc;
      if(sc<best){best=sc;winners=[p]}
      else if(sc===best)winners.push(p);
    });
    Object.keys(r.scores).forEach(p=>{stats[p].lastResults.push(winners.includes(p))});
    winners.forEach(p=>stats[p].wins++);
  });
  // Calc streaks
  Object.values(stats).forEach(s=>{
    let streak=0;
    for(let i=s.lastResults.length-1;i>=0;i--){if(s.lastResults[i])streak++;else break}
    s.streak=streak;
  });
  return stats;
}

function getTeamStats(){
  const teams={};
  state.rounds.filter(r=>r.type==='team').forEach(r=>{
    const teamScores={};
    Object.entries(r.scores).forEach(([p,s])=>{
      const t=r.teams[p]||'A';
      if(!teamScores[t])teamScores[t]={total:0,players:[]};
      teamScores[t].total+=Number(s);teamScores[t].players.push(p);
    });
    const entries=Object.entries(teamScores);
    if(entries.length<2)return;
    entries.sort((a,b)=>a[1].total-b[1].total);
    const winTeam=entries[0];
    const key=winTeam[1].players.sort().join(' & ');
    if(!teams[key])teams[key]={wins:0,rounds:0};
    teams[key].wins++;
    entries.forEach(e=>{const k=e[1].players.sort().join(' & ');if(!teams[k])teams[k]={wins:0,rounds:0};teams[k].rounds++});
  });
  return teams;
}

function renderLB(){
  const statsEl=document.getElementById('lbStats');
  const contentEl=document.getElementById('lbContent');
  if(currentLB==='individual'){
    const stats=getPlayerStats();
    const arr=Object.entries(stats).filter(([,s])=>s.rounds>0).sort((a,b)=>b[1].wins-a[1].wins||((a[1].totalScore/a[1].rounds)-(b[1].totalScore/b[1].rounds)));
    const totalRounds=state.rounds.filter(r=>r.type!=='team').length;
    statsEl.innerHTML=`
      <div class="stat-box"><div class="val">${totalRounds}</div><div class="lbl">Rounds Played</div></div>
      <div class="stat-box"><div class="val">${state.players.length}</div><div class="lbl">Players</div></div>`;
    if(!arr.length){contentEl.innerHTML='<div class="empty">No rounds yet.<br>Add your first round! üèåÔ∏è</div>';return}
    contentEl.innerHTML=arr.map(([name,s],i)=>{
      const avg=s.rounds?(s.totalScore/s.rounds).toFixed(1):'‚Äî';
      const medal=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';
      const rank=i<3?`<span class="medal-${i+1}">${medal}</span>`:(i+1);
      const streakTxt=s.streak>=2?`<span class="streak">üî• ${s.streak} wins</span>`:'';
      return `<div class="lb-row"><div class="lb-rank">${rank}</div><div class="lb-name">${name} ${streakTxt}</div><div class="lb-stats"><span class="wins">${s.wins}W</span><span>Avg: ${avg}</span><span style="font-size:.75rem;color:var(--dim)">Best: ${s.best===Infinity?'‚Äî':s.best}</span></div></div>`;
    }).join('');
  } else {
    const teams=getTeamStats();
    const arr=Object.entries(teams).sort((a,b)=>b[1].wins-a[1].wins);
    const totalTeamRounds=state.rounds.filter(r=>r.type==='team').length;
    statsEl.innerHTML=`<div class="stat-box"><div class="val">${totalTeamRounds}</div><div class="lbl">Team Rounds</div></div><div class="stat-box"><div class="val">${arr.length}</div><div class="lbl">Unique Teams</div></div>`;
    if(!arr.length){contentEl.innerHTML='<div class="empty">No team rounds yet.<br>Play a team round! ü§ù</div>';return}
    contentEl.innerHTML=arr.map(([name,s],i)=>{
      const medal=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'';
      return `<div class="team-wins-row"><span>${medal} ${name}</span><span style="color:var(--gold);font-weight:700">${s.wins}W / ${s.rounds}R</span></div>`;
    }).join('');
  }
}

// Add Round
function setRoundType(t){
  roundType=t;
  document.getElementById('typeIndividual').classList.toggle('active',t==='individual');
  document.getElementById('typeTeam').classList.toggle('active',t==='team');
  document.getElementById('teamFormatRow').classList.toggle('hidden',t==='individual');
  renderAddRound();
}
function setTeamFormat(f){
  teamFormat=f;
  document.getElementById('fmt2v2').classList.toggle('active',f==='2v2');
  document.getElementById('fmt4v4').classList.toggle('active',f==='4v4');
}

function renderAddRound(){
  if(!document.getElementById('roundDate').value){document.getElementById('roundDate').value=new Date().toISOString().slice(0,10)}
  const c=document.getElementById('playerScores');
  c.innerHTML=state.players.map((p,i)=>`
    <div class="score-input">
      <input type="checkbox" id="playing${i}" checked>
      <label for="playing${i}">${p}</label>
      <input type="number" id="score${i}" placeholder="Score" min="1">
      ${roundType==='team'?`<select id="team${i}"><option value="A">Team A</option><option value="B">Team B</option></select>`:''}
    </div>`).join('');
}

function saveRound(){
  const date=document.getElementById('roundDate').value;
  const course=document.getElementById('roundCourse').value.trim();
  if(!date){toast('Pick a date!');return}
  const scores={}, teams={};
  let count=0;
  state.players.forEach((p,i)=>{
    if(!document.getElementById('playing'+i).checked)return;
    const s=document.getElementById('score'+i).value;
    if(!s){toast(`Enter score for ${p}`);return}
    scores[p]=Number(s);count++;
    if(roundType==='team')teams[p]=document.getElementById('team'+i).value;
  });
  if(count<2){toast('Need at least 2 players!');return}
  const round={date,course:course||'Unknown Course',type:roundType,scores};
  if(roundType==='team')round.teams=teams;
  state.rounds.push(round);save();
  toast('Round saved! ‚õ≥');
  document.getElementById('roundCourse').value='';
  renderAddRound();
}

// History
function changeMonth(d){
  const [y,m]=historyMonth.split('-').map(Number);
  const dt=new Date(y,m-1+d);
  historyMonth=dt.toISOString().slice(0,7);
  renderHistory();
}

function renderHistory(){
  const months=['January','February','March','April','May','June','July','August','September','October','November','December'];
  const [y,m]=historyMonth.split('-').map(Number);
  document.getElementById('monthLabel').textContent=`${months[m-1]} ${y}`;
  const rounds=state.rounds.filter(r=>r.date.startsWith(historyMonth)).sort((a,b)=>b.date.localeCompare(a.date));
  const c=document.getElementById('historyContent');
  if(!rounds.length){c.innerHTML='<div class="empty">No rounds this month üì≠</div>';return}
  c.innerHTML=rounds.map((r,ri)=>{
    const entries=Object.entries(r.scores).sort((a,b)=>a[1]-b[1]);
    const best=entries[0][1];
    return `<div class="history-round">
      <div class="date">${r.date} ${r.type==='team'?'üë•':''}</div>
      <div class="course">${r.course}</div>
      <div class="scores">${entries.map(([p,s])=>{
        const isWinner=s===best;
        const teamBadge=r.teams?`<span class="team-label ${r.teams[p]==='A'?'team-a':'team-b'}">Team ${r.teams[p]}</span>`:'';
        return `<div class="${isWinner?'winner':''}">${isWinner?'üèÜ ':''}${p}: ${s} ${teamBadge}</div>`;
      }).join('')}</div>
      <button class="btn btn-danger" style="width:auto;margin-top:8px;padding:4px 12px;font-size:.75rem" onclick="deleteRound(${state.rounds.indexOf(r)})">Delete</button>
    </div>`;
  }).join('');
}

function deleteRound(i){if(confirm('Delete this round?')){state.rounds.splice(i,1);save();renderHistory()}}

// Settings
function renderSettings(){
  const c=document.getElementById('settingsNames');
  c.innerHTML=state.players.map((p,i)=>`<div class="setup-player"><span>${i+1}</span><input type="text" id="sn${i}" value="${p}"></div>`).join('');
  c.innerHTML+=`<div class="setup-player"><span>${state.players.length+1}</span><input type="text" id="sn${state.players.length}" placeholder="Add player..."></div>`;
}

function updateNames(){
  const names=[];
  for(let i=0;i<=state.players.length;i++){const el=document.getElementById('sn'+i);if(el){const v=el.value.trim();if(v)names.push(v)}}
  if(names.length<2){toast('Need at least 2 players!');return}
  // Update round references
  state.rounds.forEach(r=>{
    const newScores={},newTeams={};
    state.players.forEach((old,i)=>{
      if(r.scores[old]!==undefined){
        const newName=names[i]||old;
        newScores[newName]=r.scores[old];
        if(r.teams&&r.teams[old])newTeams[newName]=r.teams[old];
      }
    });
    r.scores=newScores;
    if(r.teams)r.teams=newTeams;
  });
  state.players=names;save();toast('Names updated! ‚úÖ');renderSettings();
}

function exportData(){
  const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='golf-tracker-backup.json';a.click();
}

function importData(e){
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=()=>{try{state=JSON.parse(r.result);save();toast('Data imported! ‚úÖ');showPage('leaderboard')}catch(e){toast('Invalid file!')}};
  r.readAsText(f);
}

function clearData(){if(confirm('Delete ALL data? This cannot be undone!')){localStorage.removeItem('golfTracker');state={players:[],rounds:[]};showPage('leaderboard')}}

// Init
if(!state.players.length){
  document.getElementById('setupPage').classList.add('active');
  initSetup();
} else {
  showPage('leaderboard');
}
</script>
</body>
</html>
