<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THE CLUB</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Bebas+Neue&family=Inter:wght@300;400;700;900&display=swap');

*{box-sizing:border-box;margin:0;padding:0}
:root{--black:#000;--white:#fff;--off:#0a0a0a;--gray1:#111;--gray2:#1a1a1a;--gray3:#222;--gray4:#333;--dim:#555;--muted:#888;--accent:#ccff00;--accent-dim:rgba(204,255,0,.15);--accent-glow:rgba(204,255,0,.4);--danger:#ff2040;--mono:'Space Mono',monospace;--display:'Bebas Neue',sans-serif;--sans:'Inter',sans-serif}

html{background:var(--black);overflow-x:hidden}
body{font-family:var(--sans);background:var(--black);color:var(--white);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}

::selection{background:var(--accent);color:var(--black)}
::-webkit-scrollbar{width:2px}
::-webkit-scrollbar-track{background:var(--black)}
::-webkit-scrollbar-thumb{background:var(--accent)}

/* HEADER — brutal top bar */
.topbar{position:fixed;top:0;left:0;right:0;z-index:200;display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:var(--black);border-bottom:1px solid var(--gray3)}
.topbar-brand{font-family:var(--display);font-size:1.6rem;letter-spacing:6px;color:var(--white)}
.topbar-brand span{color:var(--accent)}
.topbar-meta{font-family:var(--mono);font-size:.55rem;color:var(--dim);text-align:right;letter-spacing:2px;text-transform:uppercase}
.topbar-meta span{color:var(--accent)}

/* TABS — bottom nav, industrial */
.tabs{position:fixed;bottom:0;left:0;right:0;z-index:200;display:grid;grid-template-columns:repeat(4,1fr);background:var(--black);border-top:1px solid var(--gray3)}
.tab{padding:14px 4px 12px;text-align:center;cursor:pointer;transition:all .1s;border:none;background:none;color:var(--dim);font-family:var(--mono);font-size:.6rem;letter-spacing:3px;text-transform:uppercase;position:relative}
.tab::after{content:'';position:absolute;top:0;left:20%;right:20%;height:2px;background:var(--accent);transform:scaleX(0);transition:transform .15s}
.tab.active{color:var(--accent)}
.tab.active::after{transform:scaleX(1)}
.tab-num{font-family:var(--display);font-size:1.4rem;display:block;color:inherit;line-height:1}

/* PAGES */
.page{display:none;padding:80px 16px 90px;max-width:540px;margin:0 auto}
.page.active{display:block;animation:pageIn .2s ease-out}
@keyframes pageIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* SECTION HEADERS — oversized brutalist */
.section-title{font-family:var(--display);font-size:4rem;line-height:.85;letter-spacing:2px;margin-bottom:4px;color:var(--white)}
.section-subtitle{font-family:var(--mono);font-size:.6rem;letter-spacing:4px;color:var(--dim);text-transform:uppercase;margin-bottom:32px}
.section-subtitle span{color:var(--accent)}

/* DIVIDER */
.rule{border:none;height:1px;background:var(--gray3);margin:24px 0}
.rule-accent{background:var(--accent);height:2px}

/* STAT BLOCKS — stadium scoreboard style */
.stat-row{display:grid;grid-template-columns:repeat(3,1fr);gap:2px;margin-bottom:32px}
.stat-block{background:var(--gray1);padding:16px 12px;text-align:center;position:relative;overflow:hidden}
.stat-block::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:var(--accent);opacity:.3}
.stat-val{font-family:var(--display);font-size:2.8rem;line-height:1;color:var(--white)}
.stat-label{font-family:var(--mono);font-size:.5rem;letter-spacing:3px;color:var(--dim);text-transform:uppercase;margin-top:4px}

/* LEADERBOARD ROWS — the main event */
.lb-toggle{display:flex;gap:2px;margin-bottom:24px}
.lb-toggle-btn{flex:1;padding:10px;background:var(--gray1);border:1px solid var(--gray3);color:var(--dim);font-family:var(--mono);font-size:.65rem;letter-spacing:3px;text-transform:uppercase;cursor:pointer;text-align:center;transition:.1s}
.lb-toggle-btn.active{background:var(--accent);color:var(--black);border-color:var(--accent)}

.lb-header{display:grid;grid-template-columns:40px 1fr 60px 60px 60px;padding:8px 12px;font-family:var(--mono);font-size:.5rem;letter-spacing:2px;color:var(--dim);text-transform:uppercase;border-bottom:1px solid var(--gray3)}

.lb-item{display:grid;grid-template-columns:40px 1fr 60px 60px 60px;align-items:center;padding:14px 12px;border-bottom:1px solid var(--gray2);position:relative;transition:background .1s}
.lb-item:active{background:var(--gray2)}
.lb-item.rank-1{background:linear-gradient(90deg,rgba(204,255,0,.08),transparent)}
.lb-item.rank-1::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent)}

.lb-pos{font-family:var(--display);font-size:1.6rem;color:var(--dim);text-align:center}
.lb-item.rank-1 .lb-pos{color:var(--accent)}
.lb-item.rank-2 .lb-pos{color:var(--white)}
.lb-item.rank-3 .lb-pos{color:var(--muted)}

.lb-name-col{padding-left:4px}
.lb-name{font-family:var(--sans);font-weight:900;font-size:.95rem;text-transform:uppercase;letter-spacing:1px}
.lb-streak{font-family:var(--mono);font-size:.55rem;color:var(--accent);letter-spacing:1px;margin-top:2px}
.lb-crown{display:inline-block;margin-left:4px;font-size:.7rem}

.lb-stat{font-family:var(--display);font-size:1.3rem;text-align:center;color:var(--muted)}
.lb-item.rank-1 .lb-stat.wins-col{color:var(--accent)}
.wins-col{color:var(--white)}

/* TEAM LB */
.team-row{display:flex;justify-content:space-between;align-items:center;padding:16px 12px;border-bottom:1px solid var(--gray2)}
.team-row.rank-1{background:linear-gradient(90deg,rgba(204,255,0,.06),transparent);border-left:3px solid var(--accent)}
.team-names{font-weight:700;font-size:.85rem;text-transform:uppercase;letter-spacing:1px}
.team-names span{color:var(--dim);font-weight:400;font-size:.7rem}
.team-record{font-family:var(--display);font-size:1.8rem;color:var(--accent)}

/* ADD ROUND — cockpit mode */
.form-group{margin-bottom:20px;position:relative}
.form-label{font-family:var(--mono);font-size:.55rem;letter-spacing:4px;text-transform:uppercase;color:var(--dim);margin-bottom:6px;display:block}
.form-label::before{content:'//';color:var(--accent);margin-right:6px}

input[type=date],input[type=text],input[type=number],select{
  width:100%;padding:14px 16px;background:var(--gray1);border:1px solid var(--gray3);
  color:var(--white);font-family:var(--mono);font-size:.85rem;letter-spacing:1px;
  transition:border .15s;-webkit-appearance:none;border-radius:0}
input:focus,select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 1px var(--accent)}
input::placeholder{color:var(--gray4)}

.type-toggle{display:grid;grid-template-columns:1fr 1fr;gap:2px;margin-bottom:20px}
.type-btn{padding:16px;background:var(--gray1);border:1px solid var(--gray3);color:var(--dim);
  font-family:var(--display);font-size:1.4rem;letter-spacing:4px;cursor:pointer;text-align:center;transition:.1s}
.type-btn.active{background:var(--accent);color:var(--black);border-color:var(--accent)}

.player-score-row{display:grid;grid-template-columns:24px 1fr 80px;gap:8px;align-items:center;padding:10px 0;border-bottom:1px solid var(--gray2)}
.player-score-row.has-team{grid-template-columns:24px 1fr 70px 70px}
.ps-check{width:18px;height:18px;accent-color:var(--accent);cursor:pointer}
.ps-name{font-family:var(--sans);font-weight:700;font-size:.85rem;text-transform:uppercase;letter-spacing:1px}
.ps-name.unchecked{color:var(--gray4);text-decoration:line-through}
.ps-score{background:var(--gray1);border:1px solid var(--gray3);color:var(--white);
  font-family:var(--display);font-size:1.4rem;text-align:center;padding:8px;width:100%;-webkit-appearance:none;border-radius:0}
.ps-score:focus{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent)}
.ps-team{background:var(--gray1);border:1px solid var(--gray3);color:var(--white);
  font-family:var(--mono);font-size:.7rem;padding:10px 4px;width:100%;text-align:center;-webkit-appearance:none;border-radius:0}

.submit-btn{width:100%;padding:18px;background:var(--accent);color:var(--black);border:none;
  font-family:var(--display);font-size:1.6rem;letter-spacing:6px;cursor:pointer;
  position:relative;overflow:hidden;transition:all .1s;margin-top:24px}
.submit-btn:active{transform:scale(.98)}
.submit-btn::after{content:'';position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent);
  transform:translateX(-100%);transition:transform .4s}
.submit-btn:hover::after{transform:translateX(100%)}

/* HISTORY */
.month-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;padding:0 4px}
.month-nav button{background:none;border:1px solid var(--gray3);color:var(--white);
  font-family:var(--mono);padding:8px 16px;cursor:pointer;font-size:.8rem;transition:.1s}
.month-nav button:active{background:var(--accent);color:var(--black);border-color:var(--accent)}
.month-label{font-family:var(--display);font-size:1.8rem;letter-spacing:3px}

.history-card{border-left:2px solid var(--gray3);padding:16px 16px 16px 20px;margin-bottom:2px;background:var(--gray1);position:relative}
.history-card:hover{border-left-color:var(--accent)}
.h-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
.h-date{font-family:var(--display);font-size:1.3rem;letter-spacing:2px}
.h-course{font-family:var(--mono);font-size:.55rem;color:var(--dim);letter-spacing:2px;text-transform:uppercase}
.h-type{font-family:var(--mono);font-size:.5rem;padding:4px 8px;border:1px solid var(--gray4);color:var(--muted);letter-spacing:2px}
.h-scores{display:grid;grid-template-columns:1fr 1fr;gap:2px}
.h-score-item{display:flex;justify-content:space-between;padding:4px 8px;font-size:.8rem;background:var(--gray2)}
.h-score-item.winner{color:var(--accent);font-weight:700}
.h-score-item .h-s-val{font-family:var(--display);font-size:1.1rem}
.h-team-badge{font-family:var(--mono);font-size:.5rem;letter-spacing:1px;padding:1px 4px;margin-left:4px}
.h-team-a{border:1px solid var(--accent);color:var(--accent)}
.h-team-b{border:1px solid var(--muted);color:var(--muted)}
.h-delete{background:none;border:1px solid var(--gray4);color:var(--dim);font-family:var(--mono);
  font-size:.5rem;letter-spacing:2px;padding:4px 10px;cursor:pointer;margin-top:10px;transition:.1s;text-transform:uppercase}
.h-delete:hover{border-color:var(--danger);color:var(--danger)}

/* SETTINGS */
.settings-section{margin-bottom:32px}
.settings-section h3{font-family:var(--display);font-size:1.8rem;letter-spacing:3px;margin-bottom:4px}
.settings-section .sub{font-family:var(--mono);font-size:.5rem;color:var(--dim);letter-spacing:3px;text-transform:uppercase;margin-bottom:16px}
.name-row{display:grid;grid-template-columns:30px 1fr;gap:8px;align-items:center;margin-bottom:4px}
.name-idx{font-family:var(--display);font-size:1.4rem;color:var(--dim);text-align:center}
.name-input{background:var(--gray1);border:1px solid var(--gray3);padding:12px;color:var(--white);
  font-family:var(--sans);font-weight:700;font-size:.9rem;letter-spacing:1px;text-transform:uppercase;border-radius:0}
.name-input:focus{outline:none;border-color:var(--accent)}

.action-btn{padding:14px 24px;border:1px solid var(--gray3);background:none;color:var(--white);
  font-family:var(--mono);font-size:.7rem;letter-spacing:3px;text-transform:uppercase;cursor:pointer;
  transition:.1s;width:100%;margin-bottom:8px}
.action-btn:hover{border-color:var(--accent);color:var(--accent)}
.action-btn.danger:hover{border-color:var(--danger);color:var(--danger)}
.action-btn.primary{background:var(--accent);color:var(--black);border-color:var(--accent)}
.action-btn.primary:active{opacity:.8}

/* SETUP */
.setup-wrap{min-height:100vh;display:flex;flex-direction:column;justify-content:center;padding:40px 20px}
.setup-title{font-family:var(--display);font-size:5rem;line-height:.85;margin-bottom:4px}
.setup-sub{font-family:var(--mono);font-size:.55rem;letter-spacing:4px;color:var(--dim);text-transform:uppercase;margin-bottom:40px}
.setup-sub span{color:var(--accent)}
.setup-quote{font-family:var(--mono);font-size:.6rem;color:var(--gray4);letter-spacing:1px;margin-top:24px;text-align:center}
.setup-quote span{color:var(--accent)}

/* EMPTY STATE */
.empty-state{text-align:center;padding:60px 20px}
.empty-state .big{font-family:var(--display);font-size:3rem;color:var(--gray3);margin-bottom:8px}
.empty-state .msg{font-family:var(--mono);font-size:.6rem;color:var(--dim);letter-spacing:3px;text-transform:uppercase}

/* TOAST */
.toast{position:fixed;top:60px;left:50%;transform:translateX(-50%);background:var(--accent);color:var(--black);
  padding:12px 28px;font-family:var(--mono);font-size:.7rem;letter-spacing:3px;text-transform:uppercase;
  font-weight:700;z-index:999;animation:toastIn .3s ease}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(-20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

.hidden{display:none}

/* FORMAT TOGGLE */
.fmt-toggle{display:grid;grid-template-columns:1fr 1fr;gap:2px;margin-bottom:16px}

/* Responsive tweaks */
@media(max-width:380px){
  .section-title{font-size:3rem}
  .lb-item{grid-template-columns:32px 1fr 50px 50px 50px;padding:10px 8px}
  .lb-header{grid-template-columns:32px 1fr 50px 50px 50px}
  .stat-val{font-size:2.2rem}
}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <div class="topbar-brand">THE<span>.</span>CLUB</div>
  <div class="topbar-meta">EST <span id="estYear">2026</span><br>PRIVATE LEADERBOARD</div>
</div>

<!-- SETUP -->
<div class="page setup-wrap" id="setupPage">
  <div class="setup-title">ENTER<br>THE<br><span style="color:var(--accent)">CLUB</span></div>
  <div class="setup-sub">// register <span>your players</span> to begin</div>
  <div id="setupNames"></div>
  <button class="submit-btn" onclick="saveSetup()">INITIALIZE</button>
  <div class="setup-quote">"<span>Golf</span> is a good walk spoiled." — Mark Twain</div>
</div>

<!-- LEADERBOARD -->
<div class="page" id="leaderboardPage">
  <div class="section-title">LEADER<br>BOARD</div>
  <div class="section-subtitle">// season <span>rankings</span></div>
  
  <div class="lb-toggle">
    <div class="lb-toggle-btn active" onclick="showLB('individual')">INDIVIDUAL</div>
    <div class="lb-toggle-btn" onclick="showLB('team')">TEAMS</div>
  </div>

  <div id="lbStats" class="stat-row"></div>
  <div id="lbHeader"></div>
  <div id="lbContent"></div>
</div>

<!-- ADD ROUND -->
<div class="page" id="addRoundPage">
  <div class="section-title">NEW<br>ROUND</div>
  <div class="section-subtitle">// input <span>match data</span></div>

  <div class="form-group">
    <label class="form-label">Date</label>
    <input type="date" id="roundDate">
  </div>
  <div class="form-group">
    <label class="form-label">Course</label>
    <input type="text" id="roundCourse" placeholder="COURSE NAME">
  </div>
  
  <label class="form-label">Match Type</label>
  <div class="type-toggle">
    <div class="type-btn active" id="typeIndividual" onclick="setRoundType('individual')">SOLO</div>
    <div class="type-btn" id="typeTeam" onclick="setRoundType('team')">TEAM</div>
  </div>

  <div id="teamFormatRow" class="hidden">
    <label class="form-label">Format</label>
    <div class="fmt-toggle">
      <div class="type-btn active" id="fmt2v2" onclick="setTeamFormat('2v2')">2V2</div>
      <div class="type-btn" id="fmt4v4" onclick="setTeamFormat('4v4')">4V4</div>
    </div>
  </div>

  <label class="form-label">Players / Scores</label>
  <div id="playerScores"></div>
  <button class="submit-btn" onclick="saveRound()">SUBMIT ROUND</button>
</div>

<!-- HISTORY -->
<div class="page" id="historyPage">
  <div class="section-title">MATCH<br>LOG</div>
  <div class="section-subtitle">// round <span>history</span></div>

  <div class="month-nav">
    <button onclick="changeMonth(-1)">◂ PREV</button>
    <div class="month-label" id="monthLabel"></div>
    <button onclick="changeMonth(1)">NEXT ▸</button>
  </div>
  <div id="historyContent"></div>
</div>

<!-- SETTINGS -->
<div class="page" id="settingsPage">
  <div class="section-title">SYS<br>CONFIG</div>
  <div class="section-subtitle">// manage <span>the club</span></div>

  <div class="settings-section">
    <h3>ROSTER</h3>
    <div class="sub">// active player names</div>
    <div id="settingsNames"></div>
    <button class="action-btn primary" onclick="updateNames()" style="margin-top:12px">UPDATE ROSTER</button>
  </div>

  <hr class="rule">

  <div class="settings-section">
    <h3>DATA</h3>
    <div class="sub">// backup and restore</div>
    <button class="action-btn" onclick="exportData()">EXPORT JSON</button>
    <button class="action-btn" onclick="document.getElementById('importFile').click()">IMPORT JSON</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
    <button class="action-btn danger" onclick="clearData()">WIPE ALL DATA</button>
  </div>
</div>

<!-- TABS -->
<nav class="tabs">
  <div class="tab active" onclick="showPage('leaderboard')"><span class="tab-num">01</span>BOARD</div>
  <div class="tab" onclick="showPage('addRound')"><span class="tab-num">02</span>INPUT</div>
  <div class="tab" onclick="showPage('history')"><span class="tab-num">03</span>LOG</div>
  <div class="tab" onclick="showPage('settings')"><span class="tab-num">04</span>SYS</div>
</nav>

<script>
let state=JSON.parse(localStorage.getItem('golfTracker')||'null')||{players:[],rounds:[]};
let currentLB='individual',roundType='individual',teamFormat='2v2';
let historyMonth=new Date().toISOString().slice(0,7);

const save=()=>localStorage.setItem('golfTracker',JSON.stringify(state));
function toast(msg){const d=document.createElement('div');d.className='toast';d.textContent=msg;document.body.appendChild(d);setTimeout(()=>d.remove(),2200)}

const pageKeys=['leaderboard','addRound','history','settings'];
function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(name+'Page').classList.add('active');
  document.querySelectorAll('.tab')[pageKeys.indexOf(name)].classList.add('active');
  if(name==='leaderboard')renderLB();
  if(name==='addRound')renderAddRound();
  if(name==='history')renderHistory();
  if(name==='settings')renderSettings();
}

// SETUP
function initSetup(){
  const c=document.getElementById('setupNames');c.innerHTML='';
  for(let i=0;i<8;i++){
    c.innerHTML+=`<div class="name-row"><div class="name-idx">${String(i+1).padStart(2,'0')}</div><input class="name-input" type="text" id="sp${i}" placeholder="PLAYER ${i+1}"></div>`;
  }
}

function saveSetup(){
  const names=[];
  for(let i=0;i<8;i++){const v=document.getElementById('sp'+i).value.trim();if(v)names.push(v)}
  if(names.length<2){toast('MINIMUM 2 PLAYERS');return}
  state.players=names;save();
  document.getElementById('setupPage').classList.remove('active');
  showPage('leaderboard');
}

// LEADERBOARD
function showLB(type){
  currentLB=type;
  document.querySelectorAll('.lb-toggle-btn').forEach((b,i)=>b.classList.toggle('active',i===(type==='individual'?0:1)));
  renderLB();
}

function getPlayerStats(){
  const stats={};
  state.players.forEach(p=>stats[p]={wins:0,rounds:0,total:0,best:Infinity,worst:0,scores:[],streak:0,lastResults:[]});
  [...state.rounds].filter(r=>r.type!=='team').sort((a,b)=>a.date.localeCompare(b.date)).forEach(r=>{
    let best=Infinity,winners=[];
    Object.entries(r.scores).forEach(([p,s])=>{
      if(!stats[p])stats[p]={wins:0,rounds:0,total:0,best:Infinity,worst:0,scores:[],streak:0,lastResults:[]};
      const sc=Number(s);stats[p].rounds++;stats[p].total+=sc;stats[p].scores.push(sc);
      if(sc<stats[p].best)stats[p].best=sc;if(sc>stats[p].worst)stats[p].worst=sc;
      if(sc<best){best=sc;winners=[p]}else if(sc===best)winners.push(p);
    });
    Object.keys(r.scores).forEach(p=>stats[p].lastResults.push(winners.includes(p)));
    winners.forEach(p=>stats[p].wins++);
  });
  Object.values(stats).forEach(s=>{let st=0;for(let i=s.lastResults.length-1;i>=0;i--){if(s.lastResults[i])st++;else break}s.streak=st});
  return stats;
}

function getTeamStats(){
  const teams={};
  state.rounds.filter(r=>r.type==='team').forEach(r=>{
    const ts={};
    Object.entries(r.scores).forEach(([p,s])=>{const t=r.teams[p]||'A';if(!ts[t])ts[t]={total:0,players:[]};ts[t].total+=Number(s);ts[t].players.push(p)});
    const entries=Object.entries(ts);if(entries.length<2)return;
    entries.sort((a,b)=>a[1].total-b[1].total);
    const winKey=entries[0][1].players.sort().join(' + ');
    entries.forEach(e=>{const k=e[1].players.sort().join(' + ');if(!teams[k])teams[k]={wins:0,rounds:0};teams[k].rounds++});
    if(!teams[winKey])teams[winKey]={wins:0,rounds:0};teams[winKey].wins++;
  });
  return teams;
}

function renderLB(){
  const statsEl=document.getElementById('lbStats');
  const headerEl=document.getElementById('lbHeader');
  const contentEl=document.getElementById('lbContent');

  if(currentLB==='individual'){
    const stats=getPlayerStats();
    const arr=Object.entries(stats).filter(([,s])=>s.rounds>0).sort((a,b)=>b[1].wins-a[1].wins||(a[1].total/a[1].rounds)-(b[1].total/b[1].rounds));
    const totalRounds=state.rounds.filter(r=>r.type!=='team').length;
    const bestEver=arr.reduce((m,[,s])=>s.best<m?s.best:m,Infinity);
    statsEl.innerHTML=`
      <div class="stat-block"><div class="stat-val">${totalRounds}</div><div class="stat-label">ROUNDS</div></div>
      <div class="stat-block"><div class="stat-val">${state.players.length}</div><div class="stat-label">PLAYERS</div></div>
      <div class="stat-block"><div class="stat-val">${bestEver===Infinity?'—':bestEver}</div><div class="stat-label">BEST EVER</div></div>`;

    if(!arr.length){headerEl.innerHTML='';contentEl.innerHTML='<div class="empty-state"><div class="big">NO DATA</div><div class="msg">Submit your first round</div></div>';return}

    headerEl.innerHTML='<div class="lb-header"><span>#</span><span>PLAYER</span><span>W</span><span>AVG</span><span>BEST</span></div>';
    contentEl.innerHTML=arr.map(([name,s],i)=>{
      const avg=s.rounds?(s.total/s.rounds).toFixed(0):'—';
      const crown=i===0?' ◆':'';
      const streak=s.streak>=2?`<div class="lb-streak">▲ ${s.streak} STREAK</div>`:'';
      return `<div class="lb-item rank-${i+1}">
        <div class="lb-pos">${String(i+1).padStart(2,'0')}</div>
        <div class="lb-name-col"><div class="lb-name">${name}${i===0?'<span class="lb-crown">◆</span>':''}</div>${streak}</div>
        <div class="lb-stat wins-col">${s.wins}</div>
        <div class="lb-stat">${avg}</div>
        <div class="lb-stat">${s.best===Infinity?'—':s.best}</div>
      </div>`;
    }).join('');
  } else {
    const teams=getTeamStats();
    const arr=Object.entries(teams).sort((a,b)=>b[1].wins-a[1].wins);
    const totalTeam=state.rounds.filter(r=>r.type==='team').length;
    statsEl.innerHTML=`
      <div class="stat-block"><div class="stat-val">${totalTeam}</div><div class="stat-label">TEAM ROUNDS</div></div>
      <div class="stat-block"><div class="stat-val">${arr.length}</div><div class="stat-label">UNIQUE TEAMS</div></div>
      <div class="stat-block"><div class="stat-val">${arr.length?arr[0][1].wins:'—'}</div><div class="stat-label">TOP WINS</div></div>`;
    headerEl.innerHTML='';
    if(!arr.length){contentEl.innerHTML='<div class="empty-state"><div class="big">NO TEAMS</div><div class="msg">Play a team round first</div></div>';return}
    contentEl.innerHTML=arr.map(([name,s],i)=>`
      <div class="team-row${i===0?' rank-1':''}">
        <div><div class="team-names">${name}</div><span style="font-family:var(--mono);font-size:.5rem;color:var(--dim);letter-spacing:2px">${s.rounds} ROUND${s.rounds!==1?'S':''}</span></div>
        <div class="team-record">${s.wins}W</div>
      </div>`).join('');
  }
}

// ADD ROUND
function setRoundType(t){
  roundType=t;
  document.getElementById('typeIndividual').classList.toggle('active',t==='individual');
  document.getElementById('typeTeam').classList.toggle('active',t==='team');
  document.getElementById('teamFormatRow').classList.toggle('hidden',t==='individual');
  renderAddRound();
}
function setTeamFormat(f){
  teamFormat=f;
  document.getElementById('fmt2v2').classList.toggle('active',f==='2v2');
  document.getElementById('fmt4v4').classList.toggle('active',f==='4v4');
}

function renderAddRound(){
  if(!document.getElementById('roundDate').value)document.getElementById('roundDate').value=new Date().toISOString().slice(0,10);
  const c=document.getElementById('playerScores');
  const isTeam=roundType==='team';
  c.innerHTML=state.players.map((p,i)=>`
    <div class="player-score-row${isTeam?' has-team':''}">
      <input type="checkbox" class="ps-check" id="playing${i}" checked onchange="togglePlayer(${i})">
      <div class="ps-name" id="pname${i}">${p.toUpperCase()}</div>
      <input type="number" class="ps-score" id="score${i}" placeholder="—" min="1">
      ${isTeam?`<select class="ps-team" id="team${i}"><option value="A">TM—A</option><option value="B">TM—B</option></select>`:''}
    </div>`).join('');
}

function togglePlayer(i){
  const checked=document.getElementById('playing'+i).checked;
  document.getElementById('pname'+i).classList.toggle('unchecked',!checked);
}

function saveRound(){
  const date=document.getElementById('roundDate').value;
  const course=document.getElementById('roundCourse').value.trim();
  if(!date){toast('DATE REQUIRED');return}
  const scores={},teams={};let count=0,missing=false;
  state.players.forEach((p,i)=>{
    if(!document.getElementById('playing'+i).checked)return;
    const s=document.getElementById('score'+i).value;
    if(!s){toast(`SCORE MISSING: ${p.toUpperCase()}`);missing=true;return}
    scores[p]=Number(s);count++;
    if(roundType==='team')teams[p]=document.getElementById('team'+i).value;
  });
  if(missing)return;
  if(count<2){toast('MINIMUM 2 PLAYERS');return}
  const round={date,course:course||'UNKNOWN',type:roundType,scores};
  if(roundType==='team')round.teams=teams;
  state.rounds.push(round);save();
  toast('ROUND RECORDED');
  document.getElementById('roundCourse').value='';
  renderAddRound();
}

// HISTORY
function changeMonth(d){
  const[y,m]=historyMonth.split('-').map(Number);
  const dt=new Date(y,m-1+d);
  historyMonth=dt.toISOString().slice(0,7);
  renderHistory();
}

function renderHistory(){
  const months=['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
  const[y,m]=historyMonth.split('-').map(Number);
  document.getElementById('monthLabel').textContent=`${months[m-1]} ${y}`;
  const rounds=state.rounds.filter(r=>r.date.startsWith(historyMonth)).sort((a,b)=>b.date.localeCompare(a.date));
  const c=document.getElementById('historyContent');
  if(!rounds.length){c.innerHTML='<div class="empty-state"><div class="big">EMPTY</div><div class="msg">No rounds this month</div></div>';return}
  c.innerHTML=rounds.map(r=>{
    const entries=Object.entries(r.scores).sort((a,b)=>a[1]-b[1]);
    const best=entries[0][1];
    const globalIdx=state.rounds.indexOf(r);
    return `<div class="history-card">
      <div class="h-top">
        <div><div class="h-date">${r.date}</div><div class="h-course">${r.course.toUpperCase()}</div></div>
        <div class="h-type">${r.type==='team'?'TEAM':'SOLO'}</div>
      </div>
      <div class="h-scores">${entries.map(([p,s])=>{
        const w=s===best;
        const tb=r.teams?`<span class="h-team-badge ${r.teams[p]==='A'?'h-team-a':'h-team-b'}">T${r.teams[p]}</span>`:'';
        return `<div class="h-score-item${w?' winner':''}">${w?'◆ ':''}${p.toUpperCase()}${tb}<span class="h-s-val">${s}</span></div>`;
      }).join('')}</div>
      <button class="h-delete" onclick="deleteRound(${globalIdx})">DELETE</button>
    </div>`;
  }).join('');
}

function deleteRound(i){if(confirm('Delete this round permanently?')){state.rounds.splice(i,1);save();renderHistory()}}

// SETTINGS
function renderSettings(){
  const c=document.getElementById('settingsNames');
  c.innerHTML=state.players.map((p,i)=>`<div class="name-row"><div class="name-idx">${String(i+1).padStart(2,'0')}</div><input class="name-input" type="text" id="sn${i}" value="${p.toUpperCase()}"></div>`).join('');
  c.innerHTML+=`<div class="name-row"><div class="name-idx">${String(state.players.length+1).padStart(2,'0')}</div><input class="name-input" type="text" id="sn${state.players.length}" placeholder="ADD PLAYER"></div>`;
}

function updateNames(){
  const names=[];
  for(let i=0;i<=state.players.length;i++){const el=document.getElementById('sn'+i);if(el){const v=el.value.trim();if(v)names.push(v)}}
  if(names.length<2){toast('MINIMUM 2 PLAYERS');return}
  state.rounds.forEach(r=>{
    const ns={},nt={};
    state.players.forEach((old,i)=>{
      if(r.scores[old]!==undefined){const nn=names[i]||old;ns[nn]=r.scores[old];if(r.teams&&r.teams[old])nt[nn]=r.teams[old]}
    });
    r.scores=ns;if(r.teams)r.teams=nt;
  });
  state.players=names;save();toast('ROSTER UPDATED');renderSettings();
}

function exportData(){
  const b=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='the-club-backup.json';a.click();
}
function importData(e){
  const f=e.target.files[0];if(!f)return;
  const r=new FileReader();
  r.onload=()=>{try{state=JSON.parse(r.result);save();toast('DATA IMPORTED');showPage('leaderboard')}catch(e){toast('INVALID FILE')}};
  r.readAsText(f);
}
function clearData(){if(confirm('WIPE ALL DATA? THIS IS IRREVERSIBLE.')){localStorage.removeItem('golfTracker');state={players:[],rounds:[]};location.reload()}}

// INIT
if(!state.players.length){document.getElementById('setupPage').classList.add('active');initSetup()}
else showPage('leaderboard');
</script>
</body>
</html>
